<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>塑塑寶貝Yui的臉部進化史</title>
<style>
  :root{
    /* —— 白底桃粉主題 —— */
    --bg:#ffffff;
    --ink:#1f2230;
    --muted:#6b7280;
    --panel:#ffffff;
    --rail:#ffd6e7;               /* 時間軌：淡粉 */
    --accent:#ff5fa2;             /* 點/字重點：桃粉 */
    --accent-2:#ffc7de;           /* 光暈：更淡的粉 */
    --border:#f1e0ea;             /* 卡片邊框 */
    --shadow:0 10px 26px rgba(0,0,0,.08);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--ink);
    font-family:ui-sans-serif,system-ui,"Noto Sans TC","PingFang TC","Microsoft JhengHei",Arial;
  }

  /* Header：置中＋放大 */
  header{
    text-align:center; padding:28px 20px 18px; position:sticky; top:0; z-index:3;
    background:linear-gradient(180deg,rgba(255,255,255,.95) 0%, rgba(255,255,255,.85) 100%);
    border-bottom:1px solid var(--border); backdrop-filter: blur(6px);
  }
  h1{margin:0; font-size:34px; letter-spacing:.6px}
  .sub{color:var(--muted); font-size:14px; margin-top:8px}

  .wrap{padding:18px 20px}

  /* Timeline（白底卡片、等間距） */
  .timeline{
    background:var(--panel); border:1px solid var(--border); border-radius:16px;
    padding:18px; box-shadow:var(--shadow);
  }
  .track{
    position:relative; overflow-x:auto; overflow-y:hidden;
    padding:28px 10px 34px; scrollbar-width:thin;
  }
  .track::-webkit-scrollbar{height:8px}
  .track::-webkit-scrollbar-thumb{background:#e9e9ef;border-radius:8px}

  .rail{
    position:absolute; left:14px; right:14px; top:60px;
    height:2px; background:var(--rail); border-radius:1px;
  }

  /* 等間距：每個節點占 1fr 欄位 */
  .nodes{
    display:grid; grid-auto-flow:column; grid-auto-columns:1fr;
    align-items:center; gap:28px; min-width:100%;
  }
  .node{display:flex; flex-direction:column; align-items:center; gap:10px}
  .dot{
    width:14px; height:14px; border-radius:999px; background:var(--accent);
    box-shadow:0 0 0 6px rgba(255,95,162,.18), 0 6px 18px rgba(255,95,162,.35);
    transition:transform .15s ease;
  }
  .node:hover .dot{ transform:scale(1.15) }
  .label{font-size:13px; color:var(--ink); opacity:.95; white-space:nowrap}

  /* Popover（白底） */
  .popover{
    position:fixed; z-index:5; display:none;
    background:#fff; border:1px solid var(--border); border-radius:14px;
    box-shadow:var(--shadow);
    width:min(92vw,620px); min-width:320px; padding:12px;
    animation:fadeIn .14s ease-out;
  }
  @keyframes fadeIn{from{opacity:0; transform:translateY(6px) scale(.98)} to{opacity:1; transform:translateY(0) scale(1)}}
  .pop-img{
    width:100%; max-height:70vh; display:block; object-fit:contain; border-radius:10px; background:#000;
  }
  .pop-caption{font-size:12px; color:var(--muted); margin-top:8px}
  .nav{position:absolute; inset:0; display:flex; align-items:center; justify-content:space-between; pointer-events:none}
  .nav button{
    pointer-events:auto; border:1px solid var(--border); background:#fff; color:var(--ink);
    width:32px; height:32px; border-radius:999px; display:grid; place-items:center; cursor:pointer;
  }
  .close-btn{
    position:absolute; top:8px; right:8px;
    width:30px; height:30px; border-radius:999px; border:1px solid var(--border);
    background:#fff; color:var(--ink); display:grid; place-items:center; cursor:pointer;
  }
  .scrim{position:fixed; inset:0; background:rgba(0,0,0,.38); display:none; z-index:4; backdrop-filter: blur(2px);}

  /* Quotes 區塊 */
  .quotes{max-width:980px; margin:24px auto 80px; padding:0 12px; display:grid; gap:14px}
  .quote{
    background:#fff; border:1px solid var(--border); border-radius:14px; box-shadow:var(--shadow);
    padding:14px 16px; text-align:center;
  }
  .quote .en{font-size:16px; color:var(--ink)}
  .quote .from{margin-top:6px; font-size:13px; color:var(--muted)}
  .quote .from b{color:var(--accent)}

  /* 手機 */
  @media (max-width: 640px){
    .rail{display:none}
    .track{overflow-x:visible; padding:16px 6px 20px}
    .nodes{grid-auto-flow:row; grid-template-columns:1fr 1fr; gap:16px 12px}
    .node{align-items:flex-start}
    h1{font-size:28px}
  }
</style>
</head>
<body>
  <header>
    <h1>塑塑寶貝Yui的臉部進化史</h1>
    <div class="sub">把游標輕落在年份上，回望那年的模樣；手機輕觸即可開啟相片，再點空白處便闔上回憶。</div>
  </header>

  <div class="wrap">
    <div class="timeline">
      <div class="track">
        <div class="rail"></div>
        <div id="nodes" class="nodes"></div>
      </div>
    </div>
  </div>

  <!-- 你的兩段話 -->
  <section class="quotes">
    <div class="quote">
      <div class="en">“Love looks not with the eyes, but with the mind; and therefore is winged Cupid painted blind.”</div>
      <div class="from">— <b>William Shakespeare</b></div>
    </div>
    <div class="quote">
      <div class="en">外貌會隨著時間改變，但妳的善良與真誠，卻是我永遠看不膩的風景。</div>
      <div class="from">— <b>lhy</b></div>
    </div>
  </section>

  <div id="scrim" class="scrim"></div>
  <div id="popover" class="popover" role="dialog" aria-modal="true">
    <button class="close-btn" title="關閉" aria-label="關閉" id="closeBtn">×</button>
    <img id="popImg" class="pop-img" src="" alt="回憶照片" />
    <div class="nav">
      <button id="prevBtn" title="上一張" aria-label="上一張">‹</button>
      <button id="nextBtn" title="下一張" aria-label="下一張">›</button>
    </div>
    <div id="popCaption" class="pop-caption"></div>
  </div>

<script defer>
/* 你的檔名（與 repo 完全一致） */
const FILES = [
  "2017以前.jpg","2017以前2.jpg","2017以前3.jpg","2017以前.PNG",
  "2020.jpg","2021.jpg","2022.jpg","2023.jpg","2024.jpg","2025.jpg"
];

/* —— 分組排序（穩定版） —— */
const stripExt = f => f.replace(/\.[^/.]+$/,'');
const isYear   = s => /^\d{4}$/.test(s);
const groupKey = base => isYear(base) ? base : base.replace(/[-_]?(\d+)$/,'');
const orderVal = label => isYear(label) ? +label : (label.includes("以前") ? 0 : 999999);
function buildGroups(files){
  const map = new Map();
  for(const f of files){
    const key = groupKey(stripExt(f));
    if(!map.has(key)) map.set(key, []);
    map.get(key).push(f);
  }
  for(const [k,arr] of map) arr.sort((a,b)=>a.localeCompare(b,"zh-Hant"));
  const keys = [...map.keys()].sort((a,b)=>{
    const oa = orderVal(a), ob = orderVal(b);
    return oa!==ob ? oa-ob : a.localeCompare(b,"zh-Hant");
  });
  return {map, keys};
}

/* —— 節點（平均分布由 CSS 控制） —— */
const nodesEl = document.getElementById('nodes');
const {map: groups, keys} = buildGroups(FILES);
for (const key of keys){
  const node = document.createElement('div');
  node.className = 'node'; node.dataset.label = key; node.tabIndex = 0;
  node.innerHTML = `<div class="dot" aria-hidden="true"></div><div class="label">${key}</div>`;
  nodesEl.appendChild(node);
}

/* —— 浮層，含副檔名大小寫自動補救 —— */
const pop = document.getElementById('popover');
const scrim = document.getElementById('scrim');
const popImg = document.getElementById('popImg');
const popCap = document.getElementById('popCaption');
const btnPrev = document.getElementById('prevBtn');
const btnNext = document.getElementById('nextBtn');
const btnClose = document.getElementById('closeBtn');

let currentGroup = null, currentIdx = 0;

function openPopover(label, anchorEl){
  currentGroup = groups.get(label) || [];
  currentIdx = 0; updateImage();

  const r = anchorEl.getBoundingClientRect(), gap = 12;
  const w = pop.offsetWidth || 520, h = pop.offsetHeight || 420;
  const top = Math.max(12, r.top - h - gap);
  const left = Math.min(innerWidth - 12 - w, Math.max(12, r.left + r.width/2 - w/2));
  pop.style.top = top + "px"; pop.style.left = left + "px";

  pop.style.display = 'block'; scrim.style.display = 'block';
}
function closePopover(){ pop.style.display='none'; scrim.style.display='none'; currentGroup=null; }

function makeCandidates(filename){
  const base = stripExt(filename);
  const orig = filename.slice(filename.lastIndexOf('.')) || '';
  const cand = []; const push = u => { if(!cand.includes(u)) cand.push(u); };
  if (orig) { push(base+orig); push(base+orig.toLowerCase()); push(base+orig.toUpperCase()); }
  push(filename);
  ['.jpg','.jpeg','.png','.webp','.JPG','.JPEG','.PNG','.WEBP'].forEach(e => push(base+e));
  return cand.map(u => encodeURI(u));
}
function setImageWithFallback(filename){
  const candidates = makeCandidates(filename);
  let i = 0;
  popImg.onerror = () => { i++; if (i < candidates.length) popImg.src = candidates[i]; else popCap.textContent = `找不到圖片：${filename}`; };
  popImg.src = candidates[0];
}
function updateImage(){
  if(!currentGroup || !currentGroup.length) return;
  const name = currentGroup[currentIdx];
  setImageWithFallback(name);
  popCap.textContent = `${name}  (${currentIdx+1}/${currentGroup.length})`;
  const v = currentGroup.length>1 ? 'visible' : 'hidden';
  btnPrev.style.visibility = v; btnNext.style.visibility = v;
}

/* 事件（正確傳入 label 字串） */
nodesEl.addEventListener('mouseenter', e=>{
  const el = e.target.closest('.node'); if(!el) return;
  if (matchMedia('(hover:hover)').matches) openPopover(el.dataset.label, el);
}, true);
nodesEl.addEventListener('click', e=>{
  const el = e.target.closest('.node'); if(!el) return;
  openPopover(el.dataset.label, el);
});
scrim.addEventListener('click', closePopover);
btnClose.addEventListener('click', closePopover);
btnPrev.addEventListener('click', e=>{ e.stopPropagation(); if(!currentGroup) return; currentIdx=(currentIdx-1+currentGroup.length)%currentGroup.length; updateImage(); });
btnNext.addEventListener('click', e=>{ e.stopPropagation(); if(!currentGroup) return; currentIdx=(currentIdx+1)%currentGroup.length; updateImage(); });
addEventListener('keydown', e=>{
  if(pop.style.display!=='block') return;
  if(e.key==='Escape') closePopover();
  if(e.key==='ArrowLeft'){ currentIdx=(currentIdx-1+currentGroup.length)%currentGroup.length; updateImage(); }
  if(e.key==='ArrowRight'){ currentIdx=(currentIdx+1)%currentGroup.length; updateImage(); }
});
</script>
</body>
</html>
